// Prompt Repository System - Prisma Schema
// Adicionar ao schema.prisma existente

// ============================================
// ENUMS
// ============================================

enum UserRole {
  USER   // UsuÃ¡rio comum - pode usar prompts
  STAFF  // Staff - pode criar/editar prompts
  ADMIN  // Admin - acesso total
}

enum PromptStatus {
  DRAFT      // Rascunho (visÃ­vel apenas para staff)
  PUBLISHED  // Publicado (visÃ­vel para todos)
  ARCHIVED   // Arquivado (nÃ£o aparece em listagens)
}

enum AIModel {
  CHATGPT_4       // ChatGPT-4
  CHATGPT_4O      // ChatGPT-4o
  CHATGPT_35      // ChatGPT-3.5
  CLAUDE_OPUS     // Claude Opus 4.5
  CLAUDE_SONNET   // Claude Sonnet 4.5
  CLAUDE_HAIKU    // Claude Haiku 3.5
  GEMINI_2_FLASH  // Gemini 2.0 Flash
  GEMINI_15_PRO   // Gemini 1.5 Pro
  GEMINI_15_FLASH // Gemini 1.5 Flash
  UNIVERSAL       // Funciona em qualquer modelo
}

// ============================================
// MODELS
// ============================================

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  name          String
  phone         String?
  emailVerified DateTime?
  role          UserRole @default(USER)
  image         String?

  // Relacionamentos de Checkout (existente)
  purchases     Purchase[]

  // Relacionamentos de Prompts (novo)
  createdPrompts Prompt[]      @relation("PromptCreator")
  promptUsage    PromptUsage[]
  favoritePrompts FavoritePrompt[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([role])
}

model Prompt {
  id          String       @id @default(cuid())
  alias       String       @unique // slug amigÃ¡vel (ex: "estrutura-ebook-ficcao")
  title       String                // TÃ­tulo exibido
  description String       @db.Text // DescriÃ§Ã£o detalhada

  // Versionamento
  currentVersion String     @default("v1")
  versions       PromptVersion[]

  // CategorizaÃ§Ã£o
  tags        PromptTag[]
  models      AIModel[]           // Modelos recomendados
  category    PromptCategory? @relation(fields: [categoryId], references: [id])
  categoryId  String?

  // Controle
  status      PromptStatus @default(DRAFT)
  creatorId   String
  creator     User         @relation("PromptCreator", fields: [creatorId], references: [id])

  // EstatÃ­sticas
  usage       PromptUsage[]
  favorites   FavoritePrompt[]
  viewCount   Int          @default(0)
  copyCount   Int          @default(0)
  shareCount  Int          @default(0)

  // Metadados
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  publishedAt DateTime?

  @@index([alias])
  @@index([status])
  @@index([categoryId])
  @@index([createdAt])
}

model PromptVersion {
  id        String   @id @default(cuid())
  promptId  String
  prompt    Prompt   @relation(fields: [promptId], references: [id], onDelete: Cascade)

  version   String   // "v1", "v2", "v3"
  content   String   @db.Text // Template do prompt com {{placeholders}}

  // Placeholders
  placeholders Json   // [{ key: "topico", label: "TÃ³pico do ebook", type: "text", required: true }]

  // Metadata
  changelog String?  @db.Text // O que mudou nesta versÃ£o
  createdAt DateTime @default(now())

  @@unique([promptId, version])
  @@index([promptId])
}

model PromptCategory {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?  @db.Text
  icon        String?  // Emoji ou nome do Ã­cone
  color       String?  // Hex color
  order       Int      @default(0)

  prompts     Prompt[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([order])
}

model PromptTag {
  id       String   @id @default(cuid())
  name     String   @unique
  slug     String   @unique
  color    String?  // Hex color para exibiÃ§Ã£o

  prompts  Prompt[]

  createdAt DateTime @default(now())

  @@index([slug])
}

model PromptUsage {
  id        String   @id @default(cuid())

  promptId  String
  prompt    Prompt   @relation(fields: [promptId], references: [id], onDelete: Cascade)

  userId    String?
  user      User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  version   String   // VersÃ£o usada
  model     AIModel? // Modelo escolhido pelo usuÃ¡rio

  // Dados preenchidos (anonimizado para analytics)
  filledData Json?   // Placeholders preenchidos (opcional)

  // Metadata
  ipAddress  String?
  userAgent  String?

  createdAt DateTime @default(now())

  @@index([promptId])
  @@index([userId])
  @@index([createdAt])
  @@index([model])
}

model FavoritePrompt {
  id        String   @id @default(cuid())

  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  promptId  String
  prompt    Prompt   @relation(fields: [promptId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([userId, promptId])
  @@index([userId])
  @@index([promptId])
}

// ============================================
// SEED DATA EXAMPLE
// ============================================

// prisma/seed-prompts.ts

/*
import { PrismaClient, UserRole, PromptStatus, AIModel } from '@prisma/client'

const prisma = new PrismaClient()

async function seedPrompts() {
  // 1. Criar usuÃ¡rio staff
  const staff = await prisma.user.upsert({
    where: { email: 'pablofernando@live.com' },
    update: { role: UserRole.STAFF },
    create: {
      email: 'pablofernando@live.com',
      name: 'Pablo Fernando',
      role: UserRole.STAFF,
    },
  })

  // 2. Criar categorias
  const estruturaCategory = await prisma.promptCategory.create({
    data: {
      name: 'Estrutura de Ebooks',
      slug: 'estrutura-ebooks',
      description: 'Prompts para criar estruturas completas de ebooks',
      icon: 'ðŸ“š',
      color: '#3B82F6',
      order: 1,
    },
  })

  const edicaoCategory = await prisma.promptCategory.create({
    data: {
      name: 'EdiÃ§Ã£o e RevisÃ£o',
      slug: 'edicao-revisao',
      description: 'Prompts para revisar e melhorar textos',
      icon: 'âœï¸',
      color: '#10B981',
      order: 2,
    },
  })

  // 3. Criar tags
  const ebookTag = await prisma.promptTag.create({
    data: {
      name: 'ebook',
      slug: 'ebook',
      color: '#3B82F6',
    },
  })

  const estruturaTag = await prisma.promptTag.create({
    data: {
      name: 'estrutura',
      slug: 'estrutura',
      color: '#8B5CF6',
    },
  })

  const ficcaoTag = await prisma.promptTag.create({
    data: {
      name: 'ficÃ§Ã£o',
      slug: 'ficcao',
      color: '#EC4899',
    },
  })

  // 4. Criar prompt exemplo
  const prompt = await prisma.prompt.create({
    data: {
      alias: 'estrutura-ebook-ficcao',
      title: 'Estrutura de Ebook de FicÃ§Ã£o',
      description: 'Crie a estrutura completa de um ebook de ficÃ§Ã£o com capÃ­tulos, sinopse e arco narrativo.',
      currentVersion: 'v1',
      models: [AIModel.CHATGPT_4, AIModel.CLAUDE_OPUS],
      status: PromptStatus.PUBLISHED,
      categoryId: estruturaCategory.id,
      creatorId: staff.id,
      tags: {
        connect: [
          { id: ebookTag.id },
          { id: estruturaTag.id },
          { id: ficcaoTag.id },
        ],
      },
      versions: {
        create: {
          version: 'v1',
          content: `VocÃª Ã© um especialista em criar estruturas de ebooks de ficÃ§Ã£o que engajam e convertem leitores.

INFORMAÃ‡Ã•ES:
- TÃ³pico: {{topico}}
- PÃºblico-alvo: {{publico_alvo}}
- Tom desejado: {{tom}}

TAREFA:
Crie uma estrutura completa de ebook de ficÃ§Ã£o seguindo este formato:

1. TÃTULO E SUBTÃTULO
   - TÃ­tulo impactante e memorÃ¡vel
   - SubtÃ­tulo que clarifica o tema

2. SINOPSE (200 palavras)
   - Hook inicial
   - Conflito principal
   - Promessa de transformaÃ§Ã£o

3. ESTRUTURA DE CAPÃTULOS (10-15 capÃ­tulos)
   Para cada capÃ­tulo:
   - NÃºmero e tÃ­tulo
   - Resumo (50 palavras)
   - Objetivo do capÃ­tulo
   - Gancho para prÃ³ximo capÃ­tulo

4. ARCO NARRATIVO
   - Ponto de partida
   - Conflito crescente
   - ClÃ­max
   - ResoluÃ§Ã£o

FORMATO DE SAÃDA:
- Markdown bem formatado
- TÃ­tulos hierÃ¡rquicos claros
- Listas e bullet points

Comece agora:`,
          placeholders: [
            {
              key: 'topico',
              label: 'TÃ³pico do ebook',
              type: 'text',
              required: true,
              description: 'Ex: Romance de Ã©poca vitoriana',
            },
            {
              key: 'publico_alvo',
              label: 'PÃºblico-alvo',
              type: 'text',
              required: true,
              description: 'Ex: Mulheres 25-45 anos, fÃ£s de romance',
            },
            {
              key: 'tom',
              label: 'Tom desejado',
              type: 'text',
              required: false,
              defaultValue: 'Envolvente e acessÃ­vel',
              description: 'Ex: DramÃ¡tico, leve, inspirador',
            },
          ],
          changelog: 'VersÃ£o inicial',
        },
      },
      publishedAt: new Date(),
    },
  })

  console.log('âœ… Seed de prompts completo!')
  console.log(`   - 1 usuÃ¡rio staff criado: ${staff.email}`)
  console.log(`   - 2 categorias criadas`)
  console.log(`   - 3 tags criadas`)
  console.log(`   - 1 prompt criado: ${prompt.alias}`)
}

seedPrompts()
  .catch((e) => {
    console.error(e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
*/
